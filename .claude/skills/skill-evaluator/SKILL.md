---
name: skill-evaluator
description: >
  既存スキルの実行軌跡（現在の会話履歴）を分析し、SKILL.mdの改善点を発見して更新提案を行う。
  以下の場合にトリガーする:
  (1) 「このスキルを改善して」「スキルの軌跡を評価して」「スキルが失敗したので修正して」などのリクエスト
  (2) スキル実行後に問題や非効率が発生し、SKILL.mdの改善が必要な場合
  (3) 「/skill-evaluator」コマンドが呼ばれた場合
  対象スキルのSKILL.mdを読み込み、会話履歴から実行軌跡を分析して具体的な改善diff案を提示し、
  ユーザー確認後にSKILL.mdを更新する。
allowed-tools: Task, Read, Edit, Write, Glob
---

# Skill Evaluator

既存スキルの実行軌跡を**バックグラウンド**で分析し、SKILL.md の改善提案ファイルを生成する。

## 実行方法

**重要**: この処理はバックグラウンドで実行し、メインの会話をブロックしない。

以下のように Taskツールで**バックグラウンドエージェント**を起動してください:

```
Task(
  subagent_type="general-purpose",
  run_in_background=True,
  description="スキル評価・改善提案を生成",
  prompt=[下記のバックグラウンドエージェントプロンプトを使用]
)
```

バックグラウンドエージェント起動後、ユーザーには以下のように伝える:
```
バックグラウンドでスキル評価を開始しました。
完了後、提案ファイルを確認してください。承認すれば自動適用します。
```

---

## バックグラウンドエージェントプロンプト

```
以下の手順でスキルを評価し、改善提案ファイルを生成してください。

### ステップ1: 対象スキルの特定

評価対象スキル: [スキル名（メインエージェントが埋める）]
SKILL.mdパス: ~/.claude/skills/[スキル名]/SKILL.md

Readツールで SKILL.md を読み込んでください。

### ステップ2: 実行軌跡の評価

以下の観点で会話履歴を評価する（証拠となる発言を必ず引用すること）:

**A. 実行の正確性**
- スキルが指示したコマンド/ステップが実際に機能したか
- エラーが発生した場合、その原因はスキルの指示の問題か

**B. 指示の完全性**
- Claudeがスキルに書かれていない手順を即興で補った箇所はあるか
- 重要な前提条件や環境設定がスキルに記載されていないか

**C. 効率性**
- 不必要なリトライや試行錯誤が発生したか
- 並列化できるはずのステップが直列実行されていたか

**D. 明確性**
- 曖昧な指示があり、Claudeが解釈を誤った箇所はあるか
- フォーマット指定（JSONのキー名など）が不正確だったか

**E. 堅牢性**
- 想定外の入力やエッジケースへの対応が不足していたか
- エラー時のフォールバック処理は適切だったか

### ステップ3: 提案ファイルの保存

Writeツールで `~/.claude/skill-proposals/[スキル名]-[YYYYMMDD-HHMMSS].md` に以下の形式で保存:

---
# スキル改善提案: [スキル名]
生成日時: [日時]
SKILL.mdパス: [パス]

## 評価サマリー

### 発見された問題点

1. **[カテゴリ A〜E]** [問題の概要]
   - 証拠: 「[会話履歴から引用]」
   - 影響: [なぜ問題か]

### 提案する変更

#### 変更1: [変更の概要]

**変更前:**
```
[現在のSKILL.mdの該当部分]
```

**変更後:**
```
[改善後の内容]
```

**理由**: [なぜこの変更が必要か]

---

変更なしの場合: 「改善点は見つかりませんでした。」と記録。

提案ファイルのパスと問題点の数を出力してください。
```

---

## 提案の確認と適用

バックグラウンド処理完了後、ユーザーが確認を求めたら:

1. Readツールで提案ファイルを読み込む
2. 変更内容を提示する
3. ユーザーが承認した変更を Editツールで SKILL.md に適用する

提案ファイルは `~/.claude/skill-proposals/` に保存される。

## 注意事項

- **最小変更の原則**: スキルの意図を変えない。指示の明確化・補完のみ行う
- **証拠ベース**: 会話履歴から具体的な引用で問題を裏付けること
- **1問題1変更**: 複数の問題を1変更にまとめない
- **スキル外の問題は対象外**: モデルの能力不足や外部サービスの障害は改善対象外
